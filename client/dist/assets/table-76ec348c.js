import{u as ee,r,s as te,b as ae,j as s,c as t,L as re,d as m}from"./index-6a65ef1a.js";import{s as le,N as se}from"./sortBy-0507528e.js";import{S as oe}from"./sweetalert2.all-6cd0561d.js";import{I as ne}from"./IconTrashLines-05676ec3.js";import{I as ie}from"./IconPencil-6c35d84f.js";import{I as ce}from"./IconPlus-ee6824e4.js";import{I as U}from"./IconX-33f32414.js";import{T as j}from"./tippy-react.esm-55fc4785.js";import{Y as p,y as h}from"./transition-387bf68a.js";import"./floating-ui.dom.browser.min-e93d2b51.js";import"./_baseIsEqual-b65a80a9.js";import"./_defineProperty-e0e92f20.js";import"./keyboard-d8472279.js";const Se=()=>{const q=ee();r.useEffect(()=>{q(te("All Appointments"))});const[x,w]=r.useState(1),F=[10,20,30,50,100],[c,T]=r.useState(F[0]),[i,v]=r.useState([]),[$,P]=r.useState([]),z=ae(),[n,O]=r.useState(""),[y,B]=r.useState({columnAccessor:"id",direction:"asc"}),[de,I]=r.useState(""),[k,f]=r.useState(!1);r.useState([]);const[l,d]=r.useState(null),[A,g]=r.useState(!1),[C,M]=r.useState(""),[R,ue]=r.useState(""),[b,D]=r.useState(""),[E,_]=r.useState(""),[N,H]=r.useState([]),[S,Y]=r.useState(""),G=async()=>{try{const e=await m.get("http://localhost:4002/api/roles");console.log("API Response:",e.data),e.data.success===!0&&(H(e.data.data),console.log("Fetched roles:",e.data.data))}catch(e){console.error("Error fetching roles",e)}};r.useEffect(()=>{G()},[]);const X=async()=>{try{const e=await m.get("http://localhost:4002/api/users");if(console.log("API Response:",e.data),e.data.success===!0){const a=e.data.data;v(a),P(a.slice(0,c)),console.log("Fetched users:",a)}else console.error("Failed to fetch users:",e.data.message)}catch(e){console.error("Error fetching users",e),v([])}};r.useEffect(()=>{X()},[]);const Z=async e=>{try{const a=await m.get(`http://localhost:4002/api/editing/${e}`);if(console.log("User Details:",a.data),a.data.success){const o=a.data.data,L={id:o.userId,title:o.fullname,email:o.email,phone:o.phone,type:o.role};d(L),console.log("Fetched user to be updated:",L)}else console.error("Failed to fetch user details:",a.data.message)}catch(a){console.error("Error fetching user details:",a)}};r.useEffect(()=>{w(1)},[c]),r.useEffect(()=>{if(Array.isArray(i)){const e=(x-1)*c,a=e+c;P(i.slice(e,a))}else console.error("initialRecords is not an array:",i)},[x,c,i]),r.useEffect(()=>{v(()=>i.filter(e=>e.userId.toString().includes(n.toLowerCase())||e.fullname.toLowerCase().includes(n.toLowerCase())||e.email.toLowerCase().includes(n.toLowerCase())||e.phone.toLowerCase().includes(n.toLowerCase())||e.address.toLowerCase().includes(n.toLowerCase())||e.role.toLowerCase().includes(n.toLowerCase())))},[n]),r.useEffect(()=>{const e=le(i,y.columnAccessor);v(y.direction==="desc"?e.reverse():e),w(1)},[y]);const u=(e="",a="success")=>{oe.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:a,title:e,padding:"10px 20px"})},J=async e=>{e.preventDefault();try{console.log({fullname:C,email:R,phone:b,address:E,roleId:S});const a=await m.post("http://localhost:4002/api/register",{fullname:C,phone:b,email:R,address:E,roleId:S});console.log(a.data),a.data.success?(u("User has been created successfully."),f(!1),z("/users/user-table")):(u("Failed to update user:",a.data.message),I(a.data.error||"An error occurred"))}catch(a){console.error(a),I("An error occurred. Please try again later.")}},K=async e=>{e.preventDefault(),console.log("Updating user with ID:",l.id),console.log("Selected user Data:",l);const a={fullname:l.title,email:l.email,phone:l.phone,address:l.location,roleId:l.type};try{const o=await m.put(`http://localhost:4002/api/update_user/${l.id}`,a);o.data.success?(console.log("User updated successfully:",o.data.message),u("User has been updated successfully."),g(!1)):(u("Failed to update user:",o.data.message),console.error("Failed to update user:",o.data.message))}catch(o){console.error("Error updating user:",o)}},Q=async e=>{await Z(e),g(!0)},V=async e=>{try{const a=await m.delete(`http://localhost:4002/api/editing/${e}`);console.log("Delete Response:",a.data),a.data.success?(u("User has been deleted successfully."),console.log("User deleted successfully:",a.data.message)):(u("Failed to delete user. Please try again!"),console.error("Failed to delete user:",a.data.message))}catch(a){console.error("Error deleting user:",a)}},W=async e=>{window.confirm("Are you sure you want to delete this user?")&&await V(e)};return s("div",{children:[s("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[t("li",{children:t(re,{to:"#",className:"text-primary hover:underline",children:"Board"})}),t("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:t("span",{children:"Users"})})]}),s("div",{className:"panel mt-6",children:[s("div",{className:"flex md:items-center justify-between md:flex-row flex-col mb-4.5 gap-5",children:[t("div",{className:"flex items-center flex-wrap",children:s("button",{type:"button",className:"btn btn-primary",onClick:()=>f(!0),children:[t(ce,{className:"ltr:mr-2 rtl:ml-2"}),"Create User"]})}),t("input",{type:"text",className:"form-input w-auto",placeholder:"Search...",value:n,onChange:e=>O(e.target.value)})]}),t("div",{className:"datatables",children:t(se,{highlightOnHover:!0,className:"whitespace-nowrap table-hover",records:$,columns:[{accessor:"userId",title:"Number",sortable:!0},{accessor:"fullname",title:"Name",sortable:!0},{accessor:"email",title:"Email",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"address",title:"Address",sortable:!0},{accessor:"role",title:"Role",sortable:!0},{accessor:"actions",title:"Actions",sortable:!1,render:e=>t("div",{children:s("ul",{className:"flex items-center justify-center gap-2",children:[t("li",{children:t(j,{content:"Edit",children:t("button",{type:"button",onClick:()=>Q(e.userId),children:t(ie,{className:"text-success"})})})}),t("li",{children:t(j,{content:"Delete",children:t("button",{type:"button",onClick:()=>W(e.userId),children:t(ne,{className:"text-danger"})})})})]})})}],totalRecords:i.length,recordsPerPage:c,page:x,onPageChange:e=>w(e),recordsPerPageOptions:F,onRecordsPerPageChange:T,sortStatus:y,onSortStatusChange:B,minHeight:200,paginationText:({from:e,to:a,totalRecords:o})=>`Showing ${e} to ${a} of ${o} entries`})})]}),t(p,{appear:!0,show:k,as:r.Fragment,children:s(h,{as:"div",onClose:()=>f(!1),open:k,className:"relative z-[51]",children:[t(p.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0",children:t(h.Overlay,{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(p.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95",children:s(h.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>f(!1),children:t(U,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Add User"}),t("div",{className:"p-5",children:s("form",{className:"space-y-5",onSubmit:J,children:[s("div",{children:[t("label",{htmlFor:"title",children:"Full Name :"}),t("input",{id:"title",type:"text",name:"title",className:"form-input",placeholder:"Enter Full Name",required:!0,value:C,onChange:e=>M(e.target.value)}),t("div",{className:"text-danger mt-2",id:"titleErr"})]}),s("div",{children:[t("label",{htmlFor:"phone",children:"Email :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:b,onChange:e=>D(e.target.value)}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),s("div",{children:[t("label",{htmlFor:"email",children:"Address :"}),t("input",{id:"email",type:"text",name:"email",className:"form-input",placeholder:"Enter Address",required:!0,value:E,onChange:e=>_(e.target.value)}),t("div",{className:"text-danger mt-2",id:"emailErr"})]}),s("div",{children:[t("label",{htmlFor:"phone",children:"Phone Number :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:b,onChange:e=>D(e.target.value)}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),s("div",{children:[t("label",{htmlFor:"Type",children:"Select Role"}),t("div",{className:"relative text-white-dark",children:s("select",{id:"Type",className:"form-input ps-10 placeholder:text-white-dark",value:S,onChange:e=>Y(e.target.value),children:[t("option",{value:"",disabled:!0,children:"Select Role"}),N.length>0?N.map(e=>t("option",{value:e.roleId,children:e.roleName},e.roleId)):t("option",{value:"",disabled:!0,children:"No roles available"})]})})]}),s("div",{className:"flex justify-end items-center !mt-8",children:[t("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>f(!1),children:"Cancel"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Create User"})]})]})})]})})})})]})}),t(p,{appear:!0,show:A,as:r.Fragment,children:s(h,{as:"div",onClose:()=>g(!1),open:A,className:"relative z-[51]",children:[t(p.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0",children:t(h.Overlay,{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(p.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95",children:s(h.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>g(!1),children:t(U,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Edit User"}),t("div",{className:"p-5",children:s("form",{className:"space-y-5",onSubmit:K,children:[s("div",{children:[t("label",{htmlFor:"title",children:"Full Name :"}),t("input",{id:"title",type:"text",name:"title",className:"form-input",placeholder:"Enter Full Name",required:!0,value:(l==null?void 0:l.title)||"",onChange:e=>d({...l,title:e.target.value})}),t("div",{className:"text-danger mt-2",id:"titleErr"})]}),s("div",{children:[t("label",{htmlFor:"email",children:"Email :"}),t("input",{id:"email",type:"text",name:"email",className:"form-input",placeholder:"Enter Email",required:!0,value:(l==null?void 0:l.email)||"",onChange:e=>d({...l,email:e.target.value})}),t("div",{className:"text-danger mt-2",id:"emailErr"})]}),s("div",{children:[t("label",{htmlFor:"location",children:"Address :"}),t("input",{id:"location",type:"text",name:"location",className:"form-input",placeholder:"Enter Address",required:!0,value:(l==null?void 0:l.location)||"",onChange:e=>d({...l,location:e.target.value})}),t("div",{className:"text-danger mt-2",id:"locationErr"})]}),s("div",{children:[t("label",{htmlFor:"phone",children:"Phone Number :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:(l==null?void 0:l.phone)||"",onChange:e=>d({...l,phone:e.target.value})}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),s("div",{children:[t("label",{htmlFor:"type",children:"Select Role"}),t("div",{className:"relative text-white-dark",children:s("select",{id:"type",className:"form-input ps-10 placeholder:text-white-dark",value:(l==null?void 0:l.type)||"",onChange:e=>d({...l,type:e.target.value}),children:[t("option",{value:"",disabled:!0,children:"Select Role"}),N.length>0?N.map(e=>t("option",{value:e.roleId,children:e.roleName},e.roleId)):t("option",{value:"",disabled:!0,children:"No roles available"})]})})]}),s("div",{className:"flex justify-end items-center !mt-8",children:[t("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>g(!1),children:"Cancel"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Update User"})]})]})})]})})})})]})})]})};export{Se as default};
