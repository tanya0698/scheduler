import{u as ge,r,s as ve,d as ye,j as l,b as t,L as xe,e as G,f as w}from"./index-6d5aa60a.js";import{s as Ne,N as Ce,l as we}from"./index-8d7f0831.js";import{S as Ee}from"./sweetalert2.all-6a0b1d49.js";import{I as Se}from"./IconFile-49be1331.js";import{I as Ie}from"./IconPrinter-95a051c3.js";import{I as ke}from"./IconTrashLines-35196ac8.js";import{I as Fe}from"./IconPencil-ad07314c.js";import{I as Pe}from"./IconPlus-51d115ff.js";import{T as V}from"./tippy-react.esm-80869c7b.js";import{Y as v,y}from"./transition-5043b65c.js";import"./floating-ui.dom.browser.min-e93d2b51.js";import"./_baseIsEqual-0362420f.js";import"./_defineProperty-f579614e.js";import"./keyboard-af9e5da8.js";const Ye=()=>{const Z=ge();r.useEffect(()=>{Z(ve("All Appointments"))});const[A,R]=r.useState(1),z=[10,20,30,50,100],[b,J]=r.useState(z[0]),[d,E]=r.useState([]),[K,$]=r.useState([]),Q=ye(),[m,W]=r.useState(""),[S,ee]=r.useState({columnAccessor:"id",direction:"asc"}),[Ae,_]=r.useState(""),[M,x]=r.useState(!1);r.useState([]);const[s,g]=r.useState(null),[H,N]=r.useState(!1),[L,te]=r.useState(""),[X,Re]=r.useState(""),[I,Y]=r.useState(""),[j,ae]=r.useState(""),[k,re]=r.useState([]),[D,le]=r.useState(""),se=async()=>{try{const e=await w.get("http://9993-41-173-36-105.ngrok-free.app/api/roles");console.log("API Response:",e.data),e.data.success===!0&&(re(e.data.data),console.log("Fetched roles:",e.data.data))}catch(e){console.error("Error fetching roles",e)}};r.useEffect(()=>{se()},[]);const oe=async()=>{try{const e=await w.get("http://9993-41-173-36-105.ngrok-free.app/api/users");if(console.log("API Response:",e.data),e.data.success===!0){const a=e.data.data;E(a),$(a.slice(0,b)),console.log("Fetched users:",a)}else console.error("Failed to fetch users:",e.data.message)}catch(e){console.error("Error fetching users",e),E([])}};r.useEffect(()=>{oe()},[]);const ne=async e=>{try{const a=await w.get(`http://9993-41-173-36-105.ngrok-free.app/api/users/${e}`);if(console.log("User Details:",a.data),a.data.success){const o=a.data.data,p={id:o.userId,title:o.fullname,email:o.email,phone:o.phone,type:o.roleId};g(p),console.log("Fetched user to be updated:",p)}else console.error("Failed to fetch user details:",a.data.message)}catch(a){console.error("Error fetching user details:",a)}},ie=["Number","Name","Email","Phone","Address","Role"];r.useEffect(()=>{R(1)},[b]),r.useEffect(()=>{if(Array.isArray(d)){const e=(A-1)*b,a=e+b;$(d.slice(e,a))}else console.error("initialRecords is not an array:",d)},[A,b,d]),r.useEffect(()=>{E(()=>d.filter(e=>e.userId.toString().includes(m.toLowerCase())||e.fullname.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase())||e.phone.toLowerCase().includes(m.toLowerCase())||e.address.toLowerCase().includes(m.toLowerCase())||e.role.toLowerCase().includes(m.toLowerCase())))},[m]),r.useEffect(()=>{const e=Ne(d,S.columnAccessor);E(S.direction==="desc"?e.reverse():e),R(1)},[S]);const ce=()=>{we.downloadExcel({fileName:"users.xlsx",sheet:"Users",tablePayload:{header:["Number","Name","Email","Phone","Address","Role"],body:d.map(e=>[e.userId,e.fullname,e.email,e.phone,e.address,e.role])}})},de=e=>{let a=ie,o=d,p="table",f;if(f=window.navigator,e==="csv"){let c=";",h=`
`,n=a.map(u=>U(u)).join(c);if(n+=h,o.map(u=>{a.map((C,T)=>{T>0&&(n+=c);let q=u[C]?u[C]:"";n+=q}),n+=h}),n==null)return;if(!n.match(/^data:text\/csv/i)&&!f.msSaveOrOpenBlob){var pe="data:application/csv;charset=utf-8,"+encodeURIComponent(n),O=document.createElement("a");O.setAttribute("href",pe),O.setAttribute("download",p+".csv"),O.click()}else{var he=new Blob([n]);f.msSaveOrOpenBlob&&f.msSaveBlob(he,p+".csv")}}else if(e==="print"){var i="<p>"+p+"</p>";i+='<table style="width: 100%; " cellpadding="0" cellcpacing="0"><thead><tr style="color: #515365; background: #eff5ff; -webkit-print-color-adjust: exact; print-color-adjust: exact; "> ',a.map(c=>{i+="<th>"+U(c)+"</th>"}),i+="</tr></thead>",i+="<tbody>",o.map(c=>{i+="<tr>",a.map(h=>{let n=c[h]?c[h]:"";i+="<td>"+n+"</td>"}),i+="</tr>"}),i+="<style>body {font-family:Arial; color:#495057;}p{text-align:center;font-size:18px;font-weight:bold;margin:15px;}table{ border-collapse: collapse; border-spacing: 0; }th,td{font-size:12px;text-align:left;padding: 4px;}th{padding:8px 4px;}tr:nth-child(2n-1){background:#f7f7f7; }</style>",i+="</tbody></table>";var P=window.open("","","left=0,top=0,width=1000,height=600,toolbar=0,scrollbars=0,status=0");P.document.write("<title>Print</title>"+i),P.document.close(),P.focus(),P.print()}else if(e==="txt"){let c=",",h=`
`,n=a.map(u=>U(u)).join(c);if(n+=h,o.map(u=>{a.map((C,T)=>{T>0&&(n+=c);let q=u[C]?u[C]:"";n+=q}),n+=h}),n==null)return;if(!n.match(/^data:text\/txt/i)&&!f.msSaveOrOpenBlob){var fe="data:application/txt;charset=utf-8,"+encodeURIComponent(n),B=document.createElement("a");B.setAttribute("href",fe),B.setAttribute("download",p+".txt"),B.click()}else{var be=new Blob([n]);f.msSaveOrOpenBlob&&f.msSaveBlob(be,p+".txt")}}},U=e=>e.replace("_"," ").replace("-"," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.substring(1)).join(" "),F=(e="",a="success")=>{Ee.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:a,title:e,padding:"10px 20px"})},ue=async e=>{e.preventDefault();try{console.log({fullname:L,email:X,phone:I,address:j,roleId:D});const a=await w.post("http://9993-41-173-36-105.ngrok-free.app/api/register",{fullname:L,phone:I,email:X,address:j,roleId:D});console.log(a.data),a.data.success?(F("User has been created successfully."),x(!1),Q("/users/user-table")):(F("Failed to update user:",a.data.message),_(a.data.error||"An error occurred"))}catch(a){console.error(a),_("An error occurred. Please try again later.")}},me=async e=>{e.preventDefault(),console.log("Updating user with ID:",s.id),console.log("Selected user Data:",s);const a={fullname:s.title,email:s.email,phone:s.phone,address:s.location,roleId:s.type};try{const o=await w.put(`http://9993-41-173-36-105.ngrok-free.app/api/update_user/${s.id}`,a);o.data.success?(console.log("User updated successfully:",o.data.message),F("User has been updated successfully."),N(!1)):(F("Failed to update user:",o.data.message),console.error("Failed to update user:",o.data.message))}catch(o){console.error("Error updating user:",o)}};return l("div",{children:[l("ul",{className:"flex space-x-2 rtl:space-x-reverse",children:[t("li",{children:t(xe,{to:"#",className:"text-primary hover:underline",children:"Board"})}),t("li",{className:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2",children:t("span",{children:"Users"})})]}),l("div",{className:"panel mt-6",children:[l("div",{className:"flex md:items-center justify-between md:flex-row flex-col mb-4.5 gap-5",children:[l("div",{className:"flex items-center flex-wrap",children:[l("button",{type:"button",className:"btn btn-primary btn-sm m-1",onClick:ce,children:[t(Se,{className:"w-5 h-5 ltr:mr-2 rtl:ml-2"}),"EXCEL"]}),l("button",{type:"button",onClick:()=>de("print"),className:"btn btn-primary btn-sm m-1",children:[t(Ie,{className:"ltr:mr-2 rtl:ml-2"}),"PRINT"]}),l("button",{type:"button",className:"btn btn-primary",onClick:()=>x(!0),children:[t(Pe,{className:"ltr:mr-2 rtl:ml-2"}),"Create User"]})]}),t("input",{type:"text",className:"form-input w-auto",placeholder:"Search...",value:m,onChange:e=>W(e.target.value)})]}),t("div",{className:"datatables",children:t(Ce,{highlightOnHover:!0,className:"whitespace-nowrap table-hover",records:K,columns:[{accessor:"userId",title:"Number",sortable:!0},{accessor:"fullname",title:"Name",sortable:!0},{accessor:"email",title:"Email",sortable:!0},{accessor:"phone",title:"Phone",sortable:!0},{accessor:"address",title:"Address",sortable:!0},{accessor:"role",title:"Role",sortable:!0},{accessor:"actions",title:"Actions",sortable:!1,render:e=>t("div",{children:l("ul",{className:"flex items-center justify-center gap-2",children:[t("li",{children:t(V,{content:"Edit",children:t("button",{type:"button",onClick:a=>{const o=e.userId;console.log("Clicked User ID:",o),ne(o),N(!0)},children:t(Fe,{className:"text-success"})})})}),t("li",{children:t(V,{content:"Delete",children:t("button",{type:"button",children:t(ke,{className:"text-danger"})})})})]})})}],totalRecords:d.length,recordsPerPage:b,page:A,onPageChange:e=>R(e),recordsPerPageOptions:z,onRecordsPerPageChange:J,sortStatus:S,onSortStatusChange:ee,minHeight:200,paginationText:({from:e,to:a,totalRecords:o})=>`Showing ${e} to ${a} of ${o} entries`})})]}),t(v,{appear:!0,show:M,as:r.Fragment,children:l(y,{as:"div",onClose:()=>x(!1),open:M,className:"relative z-[51]",children:[t(v.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0",children:t(y.Overlay,{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(v.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95",children:l(y.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>x(!1),children:t(G,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Add User"}),t("div",{className:"p-5",children:l("form",{className:"space-y-5",onSubmit:ue,children:[l("div",{children:[t("label",{htmlFor:"title",children:"Full Name :"}),t("input",{id:"title",type:"text",name:"title",className:"form-input",placeholder:"Enter Full Name",required:!0,value:L,onChange:e=>te(e.target.value)}),t("div",{className:"text-danger mt-2",id:"titleErr"})]}),l("div",{children:[t("label",{htmlFor:"phone",children:"Email :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:I,onChange:e=>Y(e.target.value)}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),l("div",{children:[t("label",{htmlFor:"email",children:"Address :"}),t("input",{id:"email",type:"text",name:"email",className:"form-input",placeholder:"Enter Address",required:!0,value:j,onChange:e=>ae(e.target.value)}),t("div",{className:"text-danger mt-2",id:"emailErr"})]}),l("div",{children:[t("label",{htmlFor:"phone",children:"Phone Number :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:I,onChange:e=>Y(e.target.value)}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),l("div",{children:[t("label",{htmlFor:"Type",children:"Select Role"}),t("div",{className:"relative text-white-dark",children:l("select",{id:"Type",className:"form-input ps-10 placeholder:text-white-dark",value:D,onChange:e=>le(Number(e.target.value)),children:[t("option",{value:"",disabled:!0,children:"Select Role"}),k.length>0?k.map(e=>t("option",{value:e.roleId,children:e.roleName},e.roleId)):t("option",{value:"",disabled:!0,children:"No roles available"})]})})]}),l("div",{className:"flex justify-end items-center !mt-8",children:[t("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>x(!1),children:"Cancel"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Create User"})]})]})})]})})})})]})}),t(v,{appear:!0,show:H,as:r.Fragment,children:l(y,{as:"div",onClose:()=>N(!1),open:H,className:"relative z-[51]",children:[t(v.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0",children:t(y.Overlay,{className:"fixed inset-0 bg-[black]/60"})}),t("div",{className:"fixed inset-0 overflow-y-auto",children:t("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:t(v.Child,{as:r.Fragment,enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95",children:l(y.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[t("button",{type:"button",className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:()=>N(!1),children:t(G,{})}),t("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Edit User"}),t("div",{className:"p-5",children:l("form",{className:"space-y-5",onSubmit:me,children:[l("div",{children:[t("label",{htmlFor:"title",children:"Full Name :"}),t("input",{id:"title",type:"text",name:"title",className:"form-input",placeholder:"Enter Full Name",required:!0,value:(s==null?void 0:s.title)||"",onChange:e=>g({...s,title:e.target.value})}),t("div",{className:"text-danger mt-2",id:"titleErr"})]}),l("div",{children:[t("label",{htmlFor:"email",children:"Email :"}),t("input",{id:"email",type:"text",name:"email",className:"form-input",placeholder:"Enter Email",required:!0,value:(s==null?void 0:s.email)||"",onChange:e=>g({...s,email:e.target.value})}),t("div",{className:"text-danger mt-2",id:"emailErr"})]}),l("div",{children:[t("label",{htmlFor:"location",children:"Address :"}),t("input",{id:"location",type:"text",name:"location",className:"form-input",placeholder:"Enter Address",required:!0,value:(s==null?void 0:s.location)||"",onChange:e=>g({...s,location:e.target.value})}),t("div",{className:"text-danger mt-2",id:"locationErr"})]}),l("div",{children:[t("label",{htmlFor:"phone",children:"Phone Number :"}),t("input",{id:"phone",type:"text",name:"phone",className:"form-input",placeholder:"Enter Phone Number",required:!0,value:(s==null?void 0:s.phone)||"",onChange:e=>g({...s,phone:e.target.value})}),t("div",{className:"text-danger mt-2",id:"phoneErr"})]}),l("div",{children:[t("label",{htmlFor:"type",children:"Select Role"}),t("div",{className:"relative text-white-dark",children:l("select",{id:"type",className:"form-input ps-10 placeholder:text-white-dark",value:(s==null?void 0:s.type)||"",onChange:e=>g({...s,type:Number(e.target.value)}),children:[t("option",{value:"",disabled:!0,children:"Select Role"}),k.length>0?k.map(e=>t("option",{value:e.roleId,children:e.roleName},e.roleId)):t("option",{value:"",disabled:!0,children:"No roles available"})]})})]}),l("div",{className:"flex justify-end items-center !mt-8",children:[t("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>N(!1),children:"Cancel"}),t("button",{type:"submit",className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Update User"})]})]})})]})})})})]})})]})};export{Ye as default};
